{% extends 'blog/base.html' %}
{% block content %}
{% load staticfiles %}
{% load friendshiptags %}
{% if user.is_authenticated %}
  <div class="profile">
    <div class="sub-header colour-theme-2">
      <div class="personal-info">
        <h1 class="name">{{profile_owner.username}}</h1>
      </div>
      {% if user == profile_owner %}
      <a href="{% url 'post_new' %}"><button class="new-post-button button">New Post</button></a>
      {% else %}
        {% if user in friends %}
          <a href="{% url 'remove_friend' pk=profile_owner.id %}"> <button class="new-post-button button">Remove Friend</button></a>
        {% else %}
          {% for friend_request in friend_requests %}
            {% if friend_request.from_user == user and friend_request.to_user == profile_owner %}
              <a href="{% url 'cancel_friend_request' pk=friend_request.id %}"><button class="new-post-button button">Cancel Friend Request</button></a>
            {% endif %}
          {% empty %}
            <a href="{% url 'send_friend_request' pk=profile_owner.id %}"><button class="new-post-button button">Add Friend</button></a>
          {% endfor %}
        {% endif %}
      {% endif %}

    </div>
    <div class="friends-list">
      <h1 class="friends-list-title"> Friends:</h1>
      {% for friend in friends %}
        <div class="friend">
          <a href="{% url 'profile' pk=friend.id %}" class="friend-name">{{friend.username}}</a>
        </div>
      {% endfor %}


      {% if user == profile_owner %}
      <h1 class="friend-request-title"> Friend Requests:</h1>
      {% for friend_request in friend_requests %}
        <div class="friend">
          <a href="{% url 'profile' pk=friend_request.id %}" class="friend-name">{{friend_request.from_user}}</a>
        </div>
      {% endfor %}
      {% endif %}

      <h1 class="follow-list-title"> Followed by:</h1>
      {% for follower in followers %}
        <div class="friend">
          <a href="{% url 'profile' pk=follower.id %}" class="friend-name">{{follower.username}}</a>
        </div>
      {% endfor %}
      <h1 class="follow-list-title"> Following:</h1>
      {% for follows in following %}
        <div class="friend">
          <a href="{% url 'profile' pk=follows.id %}" class="friend-name">{{follows.username}}</a>
        </div>
      {% endfor %}

    </div>
    <div class="stream">
      {% for post in posts|dictsortreversed:"published_date" %}
        {% include "blog/post.html" %}
      {% endfor %}
    </div>
    <div class="github-page">
      <h2 class="github-title">Post Github Activity?</h2>
      <form class="github-form" action="/git" method="GET">
        <button class="header-button button" type="submit">Git Post</button>      
      </form>
    </div>
  </div>
{% endif %}
{% endblock %}